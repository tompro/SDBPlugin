<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>SDB Query Browser</title>
		
		<link rel="stylesheet" media="all" href="css/styles.css" />
		
		<script src="js/lib/jquery-1.6.1.min.js"></script>
		<script src="js/lib/underscore-min.js"></script>
		<script src="js/lib/sha1.js"></script>
		<script src="js/lib/aws_sdb.js"></script>
		<script src="js/app.js"></script>
		<script src="js/settings.js"></script>
		<script src="js/settingsEditor.js"></script>
		<script src="js/sdb.js"></script>
		<script src="js/domain.js"></script>
		<script src="js/domainView.js"></script>
		
		<script>
		
		$(function(){
			app.init();
		});
		
		
		var awsDomain = "sdb.amazonaws.com";
		var awsKey = "AKIAJID2PANQYXQWG75Q";
		var awsSecret = "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";
		
		sdb = new SDB(awsKey, awsSecret, awsDomain);
		
		function buildResultTable(data){
			var cols = {};
			var table = $('#queryResult');
			table.html('');
			var headerRow = $('<tr></tr>');
			
			_.each(data, function(item, index){
				
				_.each(item.attrs, function(value, key){
					console.log(key);
					cols[key]=key;
				})
			});
			
			_.each(cols, function(value){
				headerRow.append('<th>'+value+'</th>')
			});
			
			table.append(headerRow);
			
			_.each(data, function(item, index){
				var dataRow = $('<tr></tr>');
				_.each(cols, function(value){
					dataRow.append('<td>'+(item.attrs[value] ? item.attrs[value] : '')+'</td>');
				})
				table.append(dataRow);
			});
		}
		
		function displayDomain(name){
			sdb.select('SELECT * from ' + name, function(data){
				var queryResultContainer = $('#queryResult');
				queryResultContainer.html('');
				buildResultTable(data.items);
			});
		}
		
		
		$(function(){
			$('#doQuery').bind('click', function(){
				
				console.log('start query');
				var query = $('#query').val();
				
				sdb.select(query, function(data){
					buildResultTable(data.items);
				});
			});
		});
		
		</script>
	</head>
	<body>
		<div id="top"></div>
		<div id="left">
			<div class="container">
				<h3 class="containerHead">Choose your settings</h3>
				<div class="containerContent">
					<form id="preferenceEditor">
						<select id="preferenceSelect" name="preference"></select>
						<select id="awsRegionSelect" name="awsRegion"></select>
						<input type="button" id="addSetting" value="Add Setting" />
					</form>
				</div>
			</div>
			
			<div class="container settingsContainer">
				<h3 class="containerHead">Add settings</h3>
				<div class="containerContent">
					<form id="editSettings">
						<ul>
							<li><label for="name">Name:*</label></li>
							<li><input type="text" name="name" /></li>
							<li><label for="awsKey">AWS Key:*</label></li>
							<li><input type="text" name="awsKey" /></li>
							<li><label for="awsSecret">AWS Secret:*</label></li>
							<li><input type="text" name="awsSecret" /></li>
							<li><input type="submit" id="saveSetting" value="save" /><input type="button" class="cancel" value="cancel"/></li>
						</ul>
					</form>
				</div>
			</div>
			
			<div class="container">
				<h3 class="containerHead">Domains</h3>
					<ul id="sdbDomains" class="containerContent"></ul>
			</div>
			
			<div class="container">
				<h3 class="containerHead">Add Domain</h3>
				<form class="containerContent">
					<label for="domainName">Domain Name:</label><br/>
					<input type="text" id="domainName" name="domainName" />
					<input type="submit" id="saveDomain" value="create Domain" />
					<div class="clear"></div>
				</form>
			</div>
		</div>
		
		<div id="right">
			<div class="container">
				<h3 class="containerHead">Enter Query</h3>
				<form id="queryForm" class="containerContent">
					<textarea id="query"></textarea>
					<input id="doQuery" type="button" value="Run Query" />
					<div class="clear"></div>
				</form>
			</div>
			
			<div class="container">
				<h3 class="containerHead">Query Result</h3>
				<div id="queryResultContainer" class="containerContent">
					<table id="queryResult"></table>
				</div>	
			</div>
		</div>
		
		<div class="clear"></div>
	</body>
</html>