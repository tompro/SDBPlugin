<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>SDB Query Browser</title>
		
		<script src="js/lib/jquery-1.6.1.min.js"></script>
		<script src="js/lib/underscore-min.js"></script>
		<script src="js/lib/sha1.js"></script>
		<script src="js/lib/aws_sdb.js"></script>
		<script src="js/app.js"></script>
		<script src="js/settings.js"></script>
		<script src="js/settingsEditor.js"></script>
		<script src="js/sdb.js"></script>
		<script src="js/domain.js"></script>
		<script src="js/domainView.js"></script>
		
		<script>
		
		$(function(){
			app.init();
		});
		
		
		var awsDomain = "sdb.amazonaws.com";
		var awsKey = "AKIAJID2PANQYXQWG75Q";
		var awsSecret = "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";
		
		sdb = new SDB(awsKey, awsSecret, awsDomain);
		
		function buildResultTable(data){
			var cols = {};
			var table = $('#queryResult');
			table.html('');
			var headerRow = $('<tr></tr>');
			
			_.each(data, function(item, index){
				
				_.each(item.attrs, function(value, key){
					console.log(key);
					cols[key]=key;
				})
			});
			
			_.each(cols, function(value){
				headerRow.append('<th>'+value+'</th>')
			});
			
			table.append(headerRow);
			
			_.each(data, function(item, index){
				var dataRow = $('<tr></tr>');
				_.each(cols, function(value){
					dataRow.append('<td>'+(item.attrs[value] ? item.attrs[value] : '')+'</td>');
				})
				table.append(dataRow);
			});
		}
		
		function displayDomain(name){
			sdb.select('SELECT * from ' + name, function(data){
				var queryResultContainer = $('#queryResult');
				queryResultContainer.html('');
				buildResultTable(data.items);
			});
		}
		
		
		$(function(){
			$('#doQuery').bind('click', function(){
				
				console.log('start query');
				var query = $('#query').val();
				
				sdb.select(query, function(data){
					buildResultTable(data.items);
				});
			});
		});
		
		</script>
		
		<style>
			div{border: 1px solid black;}
			.clear{clear:both}
			#left {float:left; width: 18%; display: inline; margin-left: 0;}
			#query{width:100%; height: 80px}
			#sdbDomains {list-style: none; margin-left: 0; padding:10px; border: 1px solid black; overflow:auto; height: 600px;}
			#sdbDomains li {margin-left: 0; list-style: none}
			#right{float:right; width: 80%}
		</style>
	</head>
	<body>
		<div id="left">
			<form id="preferenceEditor">
				<select id="preferenceSelect" name="preference"></select>
				<select id="awsRegionSelect" name="awsRegion"></select>
				<input type="button" id="addSetting" value="Add Setting" />
			</form>
			
			<form id="editSettings">
				<ul>
					<li><label for="name">Name:*</label></li>
					<li><input type="text" name="name" /></li>
					<li><label for="awsKey">AWS Key:*</label></li>
					<li><input type="text" name="awsKey" /></li>
					<li><label for="awsSecret">AWS Secret:*</label></li>
					<li><input type="text" name="awsSecret" /></li>
					<li><input type="submit" id="saveSetting" value="save" /></li>
				</ul>
			</form>
			
			<ul id="sdbDomains"></ul>
			
			<form>
				<label for="domainName">Domain Name:</label><br/>
				<input type="text" id="domainName" name="domainName" />
				<input type="submit" id="saveDomain" value="create Domain" />
			</form>
			
			<form class="hiddenDeleteDomain">
				<input type="submit" id="deleteDomain" value="delete this Domain" />
			</form>
			
		</div>
		
		<div id="right">
			<form id="queryForm">
				<textarea id="query"></textarea>
				<input id="doQuery" type="button" value="query" />
			</form>
			
			<div id="queryResultContainer">
				<table id="queryResult"></table>
			</div>	
		</div>
		
		
		<div class="clear"></div>
	</body>
</html>